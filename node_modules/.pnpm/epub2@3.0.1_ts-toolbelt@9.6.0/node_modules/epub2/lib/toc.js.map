{"version":3,"file":"toc.js","sourceRoot":"","sources":["toc.ts"],"names":[],"mappings":";AAAA;;GAEG;;;AAKH,SAAgB,MAAM,CAAC,IAAoB;IAE1C,IAAI,aAAa,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAE/C,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EACpB;QACC,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;YAErD,IACC,CAAC,UAAU,EAAE,0BAA0B,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC;mBAC9D,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAEnC;gBACC,OAAO,KAAK,CAAC;aACb;YAED,OAAO,IAAI,CAAC;QACb,CAAC,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC;KACZ;IAED,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,GAAG,EAAE,GAAG;QAElC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,EAC1B;YACC,KAAK,IAAI,CAAC,IAAI,aAAa,EAC3B;gBACC,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAE3B,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,EAC9F;oBACC,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;iBACX;aACD;SACD;IACF,CAAC,CAAC,CAAC;IAEH,OAAO,IAAI,CAAC;AACb,CAAC;AAvCD,wBAuCC","sourcesContent":["/**\n * Created by user on 2018/3/18/018.\n */\n\nimport { EPub } from '../index';\nimport { EPub as libEPub } from './epub';\n\nexport function fixToc(epub: EPub | libEPub)\n{\n\tlet manifest_keys = Object.keys(epub.manifest);\n\n\tif (!epub.toc.length)\n\t{\n\t\tepub.toc = Object.values(epub.manifest).filter(node => {\n\n\t\t\tif (\n\t\t\t\t['text/css', 'application/x-dtbncx+xml'].includes(node.mediaType)\n\t\t\t\t|| /^(image)/.test(node.mediaType)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\treturn epub;\n\t}\n\n\tepub.toc.forEach(function (toc, idx)\n\t{\n\t\tif (!epub.manifest[toc.id])\n\t\t{\n\t\t\tfor (let k of manifest_keys)\n\t\t\t{\n\t\t\t\tlet row = epub.manifest[k];\n\n\t\t\t\tif ((row.href == toc.href) || (row.href.replace(/#.+$/g, '') == toc.href.replace(/#.+$/g, '')))\n\t\t\t\t{\n\t\t\t\t\ttoc.id = k;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\treturn epub;\n}\n"]}